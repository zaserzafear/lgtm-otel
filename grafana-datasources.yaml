apiVersion: 1

datasources:
  # =====================
  # LOKI
  # =====================
  - name: Loki
    uid: loki
    type: loki
    access: proxy
    orgId: 1
    url: http://loki:3100
    isDefault: true
    editable: true

  # =====================
  # MIMIR (PROMETHEUS API)
  # =====================
  - name: Mimir
    uid: mimir
    type: prometheus
    access: proxy
    orgId: 1
    url: http://mimir:9009/prometheus
    editable: true
    jsonData:
      prometheusType: Mimir
      prometheusVersion: 3.0.0
      httpMethod: POST
      timeInterval: 15s
      exemplarTraceIdDestinations:
        - datasourceUid: tempo
          name: trace_id

  # =====================
  # TEMPO
  # =====================
  - name: Tempo
    uid: tempo
    type: tempo
    access: proxy
    orgId: 1
    url: http://tempo:3200
    editable: true
    jsonData:
      httpMethod: GET

      tracesToLogs:
        datasourceUid: loki
        tags:
          - key: service.name
            value: service
        mapTagNamesEnabled: true
        spanStartTimeShift: "-5m"
        spanEndTimeShift: "5m"
        filterByTraceID: true

      tracesToMetrics:
        datasourceUid: mimir
        tags:
          - key: service.name
            value: service

      serviceMap:
        datasourceUid: mimir
